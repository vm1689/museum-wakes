<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0c0a08" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Museum Wakes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css?v=2" />
</head>
<body>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 1: PROLOGUE
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-prologue" class="screen active">
    <!-- Intro video overlay (hidden until Begin pressed) -->
    <div id="prologue-video-wrap" class="prologue-video-wrap hidden">
      <video id="prologue-video" class="prologue-video" playsinline muted preload="auto">
        <source src="/intro-video.mp4" type="video/mp4" />
      </video>
      <button id="prologue-skip-btn" class="prologue-skip-btn" onclick="APP.skipIntroVideo()">Skip</button>
    </div>

    <div class="prologue-bg">
      <img class="prologue-bg-img" src="/images/prologue-bg.png" alt="" />
      <div class="prologue-bg-overlay"></div>
    </div>
    <div class="prologue-content" id="prologue-content">
      <div class="prologue-eye">&lrm;&#x13080;</div>
      <h1 class="prologue-title">MUSEUM WAKES</h1>
      <p class="prologue-subtitle">An Egyptian Mystery</p>

      <p class="prologue-tagline">The lights dim. The artifacts stir.<br/>The gods need your help.</p>

      <button class="btn-gold" id="prologue-continue-btn" onclick="APP.beginQuest()">
        Begin the Quest
      </button>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 2: AGE SELECT
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-age" class="screen">
    <div class="age-header">
      <div class="age-eye">&lrm;&#x13080;</div>
      <h2 class="age-title">Who Enters the Gallery?</h2>
      <p class="age-subtitle">This shapes how the gods speak to you</p>
    </div>
    <div class="age-options">
      <button class="age-card" onclick="APP.setAge('kid')">
        <img class="age-icon-img" src="/icons/age-kid.png" alt="Young Explorer" onerror="this.outerHTML='<div class=age-icon>&#9889;</div>'" />
        <div class="age-label">Young Explorer</div>
        <div class="age-desc">Ages 8&ndash;12</div>
      </button>
      <button class="age-card" onclick="APP.setAge('teen')">
        <img class="age-icon-img" src="/icons/age-teen.png" alt="Seeker" onerror="this.outerHTML='<div class=age-icon>&#128481;&#65039;</div>'" />
        <div class="age-label">Seeker</div>
        <div class="age-desc">Ages 13&ndash;17</div>
      </button>
      <button class="age-card" onclick="APP.setAge('adult')">
        <img class="age-icon-img" src="/icons/age-adult.png" alt="Scholar" onerror="this.outerHTML='<div class=age-icon>&#9765;</div>'" />
        <div class="age-label">Scholar</div>
        <div class="age-desc">Ages 18+</div>
      </button>
      <button class="age-card" onclick="APP.setAge('family')">
        <img class="age-icon-img" src="/icons/age-family.png" alt="Family" onerror="this.outerHTML='<div class=age-icon>&#127963;&#65039;</div>'" />
        <div class="age-label">Family</div>
        <div class="age-desc">All ages together</div>
      </button>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 3: PATH SELECT
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-paths" class="screen">
    <div class="paths-header">
      <button class="back-btn" onclick="APP.showAgeSelect()">&larr; Back</button>
      <h2 class="paths-title">Choose Your Path</h2>
      <p class="paths-subtitle">How will you restore Ma&rsquo;at?</p>
    </div>
    <div class="paths-grid" id="paths-grid">
      <!-- Generated by JS -->
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 4: PATH INTRO
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-path-intro" class="screen">
    <div class="path-intro-header">
      <button class="home-btn" onclick="APP.goHome()" title="Back to Paths">&larr; Paths</button>
      <div class="path-intro-icon" id="path-intro-icon"></div>
      <h2 class="path-intro-name" id="path-intro-name"></h2>
      <p class="path-intro-subtitle" id="path-intro-subtitle"></p>
    </div>
    <div class="path-intro-narration" id="path-intro-narration">
      <div class="narration-loading">
        <span class="thinking-dot"></span>
        <span class="thinking-dot"></span>
        <span class="thinking-dot"></span>
      </div>
    </div>
    <div class="path-intro-actions">
      <button class="btn-gold" id="path-intro-begin" style="display:none" onclick="APP.beginPath()">
        Begin
      </button>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 5: GAMEPLAY — Cinematic Scroll
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-gameplay" class="screen">

    <!-- Atmospheric background -->
    <div class="gp-atmosphere">
      <div class="gp-vignette"></div>
      <div class="gp-ambient-glow"></div>
      <div class="gp-particle"></div>
      <div class="gp-particle"></div>
      <div class="gp-particle"></div>
      <div class="gp-particle"></div>
      <div class="gp-particle"></div>
    </div>

    <!-- Header — guide name + act pips -->
    <div class="gp-header">
      <button class="home-btn gp-home-btn" onclick="APP.goHome()" title="Back to Paths">&larr;</button>
      <div class="gp-header-left">
        <div class="gp-guide-icon" id="gp-guide-icon"></div>
        <div class="gp-guide-name" id="gp-guide-name"></div>
      </div>
      <div class="gp-act-display">
        <div class="gp-act-label" id="gp-act-label">Act I</div>
        <div class="gp-act-pips" id="gp-act-pips">
          <div class="act-pip pip-active"></div>
          <div class="act-pip"></div>
          <div class="act-pip"></div>
          <div class="act-pip"></div>
        </div>
      </div>
    </div>

    <div class="gp-divider"></div>

    <!-- Story scroll -->
    <div class="gp-scroll" id="gp-scroll">
      <div class="gp-scroll-content" id="gp-scroll-content">
        <!-- Story entries injected by JS -->
      </div>
      <div id="gp-thinking" class="gp-thinking" style="display:none">
        <span class="thinking-dot"></span>
        <span class="thinking-dot"></span>
        <span class="thinking-dot"></span>
      </div>
    </div>

    <!-- Chat drawer — hidden by default, toggled via button -->
    <div class="gp-chat-drawer" id="gp-chat-drawer" style="display:none">
      <input id="gp-chat-input" class="chat-input" type="text"
        placeholder="Speak to the gods..." maxlength="200"
        onkeydown="if(event.key==='Enter') APP.sendMessage()" />
      <button class="chat-send" onclick="APP.sendMessage()">&uarr;</button>
    </div>

    <!-- Actions — The Eye of Horus -->
    <div class="gp-actions-area">
      <button class="gp-eye-btn" id="gp-eye-btn" onclick="APP.openScanner()">
        <div class="eye-glow"></div>
        <div class="eye-symbol">&lrm;&#x13080;</div>
        <div class="eye-label">SCAN</div>
      </button>
      <button class="gp-browse-btn" onclick="APP.skipToBrowse()">BROWSE</button>
      <button class="gp-skip-btn" id="gp-skip-btn" onclick="APP.skipTarget()">SKIP</button>
      <button class="gp-convergence-btn" id="gp-convergence-btn" style="display:none"
        onclick="APP.startConvergence()">&#9765; Enter the Hall</button>
      <div class="gp-secondary-actions">
        <button class="gp-voice-toggle" id="gp-voice-toggle" onclick="APP.toggleVoiceMode()" title="Voice Mode">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
        </button>
        <button class="gp-chat-toggle" onclick="APP.toggleChat()" title="Chat">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        </button>
        <button class="gp-menu-btn" onclick="APP.showMenu()" title="Menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       ACT TRANSITION OVERLAY
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="act-transition-overlay" class="act-transition-overlay">
    <div class="act-transition-content">
      <div class="act-transition-number" id="act-transition-number">Act II</div>
      <div class="act-transition-name" id="act-transition-name">THE DESCENT</div>
    </div>
  </div>

  <!-- Scanner screen removed — now uses take-photo flow directly -->
  <canvas id="camera-canvas" style="display:none"></canvas>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 5c: DEMO SCANNER
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-demo-scanner" class="screen">
    <div class="demo-header">
      <div class="demo-header-nav">
        <button class="back-btn" onclick="APP.closeDemoScanner()">&larr; Back</button>
        <button class="home-btn" onclick="APP.goHome()" title="Back to Paths">&larr; Paths</button>
      </div>
      <h3 class="demo-title">Browse Artifacts</h3>
      <p class="demo-subtitle">Select an artifact to scan</p>
    </div>
    <div class="demo-search">
      <input id="demo-search-input" class="demo-search-input" type="text"
        placeholder="Search artifacts..." oninput="APP.demoSearch(this.value)" />
    </div>
    <div class="demo-gallery-select">
      <label class="demo-label">Gallery:</label>
      <select id="demo-gallery-select" class="demo-select" onchange="APP.demoLoadGallery(this.value)">
        <option value="">All Egyptian Wing</option>
      </select>
    </div>
    <div class="demo-results" id="demo-results">
      <!-- Artifact cards injected here -->
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 6: CONVERGENCE
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-convergence" class="screen">
    <button class="home-btn home-btn-floating" onclick="APP.goHome()" title="Back to Paths">&larr; Paths</button>
    <div class="conv-bg">
      <div class="conv-glow"></div>
    </div>
    <div class="conv-content">
      <div class="conv-icon">&#9878;&#65039;</div>
      <h2 class="conv-title">The Hall of Two Truths</h2>
      <div class="conv-subtitle">The Weighing of the Heart</div>

      <div class="conv-narration" id="conv-narration">
        <div class="narration-loading">
          <span class="thinking-dot"></span>
          <span class="thinking-dot"></span>
          <span class="thinking-dot"></span>
        </div>
      </div>

      <!-- Player reflection input -->
      <div id="conv-reflection" style="display:none">
        <p class="conv-prompt" id="conv-prompt">What did you learn on your journey?</p>
        <textarea id="conv-input" class="conv-textarea"
          placeholder="Speak to Osiris..." rows="3" maxlength="500"></textarea>
        <button class="btn-gold" onclick="APP.submitReflection()">Offer Your Answer</button>
      </div>

      <!-- Weighing result -->
      <div id="conv-result" style="display:none">
        <div class="conv-scale" id="conv-scale">&#9878;&#65039;</div>
        <div class="conv-verdict" id="conv-verdict"></div>
        <button class="btn-gold" onclick="APP.showEpilogue()">Continue</button>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       SCREEN 7: EPILOGUE
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="screen-epilogue" class="screen">
    <div class="epilogue-content">
      <div class="epilogue-border">
        <div class="epilogue-scroll">
          <div class="scroll-header">
            <div class="scroll-eye">&#x133B9;</div>
            <h2 class="scroll-title">Your Journey</h2>
            <div class="scroll-path" id="scroll-path"></div>
          </div>

          <div class="scroll-body" id="scroll-body">
            <div class="narration-loading">
              <span class="thinking-dot"></span>
              <span class="thinking-dot"></span>
              <span class="thinking-dot"></span>
            </div>
          </div>

          <div class="scroll-artifacts">
            <div class="scroll-section-title">Artifacts Discovered</div>
            <div class="scroll-artifact-list" id="scroll-artifacts"></div>
          </div>

          <div class="scroll-footer">
            <div class="scroll-seal">&lrm;&#x13080;</div>
            <div class="scroll-signed">Witnessed by Thoth, Keeper of Records</div>
          </div>
        </div>
      </div>

      <div class="epilogue-actions">
        <button class="btn-gold" onclick="APP.shareScroll()">Share Your Scroll</button>
        <button class="btn-ghost" onclick="APP.restart()">Play Again</button>
        <button class="home-btn" onclick="APP.goHome()" title="Back to Paths">&larr; Choose Another Path</button>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       MENU OVERLAY
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="menu-overlay" class="menu-overlay" style="display:none">
    <div class="menu-panel">
      <h3 class="menu-title">&lrm;&#x13080; Museum Wakes</h3>
      <div class="menu-progress" id="menu-progress"></div>
      <div class="menu-items">
        <button class="menu-item" onclick="APP.showClues()">&#128220; Story &amp; Artifacts</button>
        <button class="menu-item" onclick="APP.toggleVoice()">&#128266; Toggle Voice</button>
        <button class="menu-item" onclick="APP.closeMenu()">&larr; Resume</button>
        <button class="menu-item menu-danger" onclick="APP.confirmRestart()">&#8634; Start Over</button>
      </div>
      <button class="menu-close" onclick="APP.closeMenu()">&times;</button>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════════════════
       CLUES OVERLAY
       ══════════════════════════════════════════════════════════════════════ -->
  <div id="clues-overlay" class="menu-overlay" style="display:none">
    <div class="menu-panel clues-panel-full">
      <h3 class="menu-title">Story &amp; Artifacts</h3>
      <div class="clues-list" id="clues-list-full">
        <p class="empty-state">No artifacts scanned yet.</p>
      </div>
      <button class="btn-ghost" onclick="APP.closeClues()">&larr; Back</button>
    </div>
  </div>

  <!-- Scripts — order matters: narrative-engine before story-engine -->
  <script src="voice.js"></script>
  <script src="gemini-voice.js"></script>
  <script src="narrative-engine.js"></script>
  <script src="claude.js"></script>
  <script src="catalog.js"></script>
  <script src="path-data.js"></script>
  <script src="story-engine.js?v=2"></script>
  <script src="camera.js"></script>
  <script src="app.js?v=2"></script>

</body>
</html>
